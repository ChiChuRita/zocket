---
title: Procedures
description: Defining inputs, handlers, and validation
icon: lucide:function-square
---

Procedures (incoming messages) are the **client → server** entry points in your Zocket router.

## Anatomy of a Procedure

A procedure consists of three parts:
1.  **Input Validation** (Optional)
2.  **Middleware** (Optional)
3.  **Handler** (Required)

In code, middleware is applied via `.use(...)` **before** `.input(...)`.

```typescript
const sendMessage = zo.message
  .use(authMiddleware) // 2. Middleware (runs before handler)
  .input(z.object({ text: z.string() })) // 1. Input
  .handle(({ ctx, input }) => {          // 3. Handler
    console.log(ctx.clientId, input.text);
  });
```

## Input Validation

Zocket uses your schema validation library (Zod, Valibot, etc.) to validate incoming data.

```typescript
.input(
  z.object({
    title: z.string().min(1),
    tags: z.array(z.string()).max(5).optional()
  })
)
```

If the input is invalid, the handler will **not** run.

As of `@zocket/core@0.1.0`, invalid payloads are logged on the server and the message is dropped (there is not yet a structured “validation error” response back to the client).

## The Handler

The `.handle()` method is where your business logic lives. It receives an object with:
- `ctx`: The context object for the current connection.
- `input`: The validated input data.

For type-safe server → client events, prefer the typed `send` helper passed to `.incoming(({ send }) => ...)` (it mirrors your `.outgoing(...)` definitions).

```typescript
.handle(async ({ ctx, input }) => {
  // Database operations
  const post = await db.post.create({
    data: { title: input.title, authorId: ctx.user.id }
  });

  // Return values (RPC style)
  return post;
})
```

## Async Handlers

Handlers can be asynchronous. If you return a value (or a Promise that resolves to a value), the client can `await` the call to receive that value.

```typescript
// Server
.handle(async () => {
  return { ok: true as const };
})

// Client
const result = await client.example.myProcedure({}); // { ok: true }
```

If your handler returns `void`, the generated client method is typed as `void` (so it’s not awaitable in TypeScript). If you want an “ack”, return something like `{ ok: true }`.
