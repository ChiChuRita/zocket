---
title: Context
description: State management per connection
icon: lucide:database
---

Context (`ctx`) is an object that persists for the lifetime of a WebSocket connection. It is the place to store user information, database connections, and other stateful data.

## Creating Context

You define the initial context in the `zocket.create` configuration.

```typescript
const zo = zocket.create({
  // 1. Define schema for connection headers/query params
  headers: z.object({
    authorization: z.string().optional(),
    "x-api-key": z.string().optional(),
  }),

  // 2. Create context from headers
  onConnect: async (headers, clientId) => {
    // Validate token
    const user = headers.authorization 
      ? await verifyToken(headers.authorization)
      : null;

    // Return the initial context
    return {
      user,
      clientId, // useful to keep
      connectedAt: new Date(),
    };
  },
});
```

## Using Context

The `ctx` object is available in all handlers and middleware.

```typescript
.handle(({ ctx }) => {
  console.log(`User ${ctx.user?.name} connected at ${ctx.connectedAt}`);
})
```

## Built-in Context

Zocket automatically adds the following properties to your context:

| Property | Type | Description |
| :--- | :--- | :--- |
| `clientId` | `string` | Unique identifier for the connection |
| `rooms` | `RoomManager` | Helper to join/leave rooms |

### Room Manager

The `ctx.rooms` object has the following API:

- `join(roomId: string)`: Add the connection to a room.
- `leave(roomId: string)`: Remove the connection from a room.
- `has(roomId: string)`: Check if the connection is in a room.

```typescript
.handle(({ ctx, input }) => {
  if (input.subscribe) {
    ctx.rooms.join(`channel:${input.channelId}`);
  } else {
    ctx.rooms.leave(`channel:${input.channelId}`);
  }
})
```
