---
title: Receiving Messages
description: Learn how to receive and handle messages from the server.
---

# Receiving Messages

Use `client.on` to listen for messages from the server with full type safety.

## Basic Listener

```typescript
client.on.chat.onMessage((data) => {
  console.log(`${data.user}: ${data.text}`);
});
```

## Type Safety

Listeners are fully typed based on your router:

```typescript
// Server defines
const router = {
  chat: {
    onMessage: zo.message.outgoing({
      payload: z.object({
        user: z.string(),
        text: z.string(),
        timestamp: z.date(),
      }),
    }),
  },
};

// Client has full type inference
client.on.chat.onMessage((data) => {
  data.user; // string
  data.text; // string
  data.timestamp; // Date

  data.typo; // ❌ Type error: doesn't exist
});
```

## Complete Example

```typescript
import { createZocketClient } from "@zocket/core";
import type { AppRouter } from "./server";

const client = createZocketClient<AppRouter>("ws://localhost:3000");

// Listen for chat messages
client.on.chat.onMessage((data) => {
  const messageEl = document.createElement("div");
  messageEl.textContent = `${data.user}: ${data.text}`;
  document.querySelector("#messages").appendChild(messageEl);
});

// Listen for typing indicators
client.on.chat.onTyping((data) => {
  if (data.isTyping) {
    document.querySelector("#typing").textContent = `${data.user} is typing...`;
  } else {
    document.querySelector("#typing").textContent = "";
  }
});

// Listen for user joins
client.on.users.onJoin((data) => {
  console.log(`${data.username} joined!`);
});

// Listen for notifications
client.on.notification.onReceive((data) => {
  showNotification(data.type, data.message);
});
```

## Unsubscribing

Listeners return an unsubscribe function:

```typescript
const unsubscribe = client.on.chat.onMessage((data) => {
  console.log(data);
});

// Later, stop listening
unsubscribe();
```

## Multiple Listeners

You can have multiple listeners for the same event:

```typescript
// Log all messages
client.on.chat.onMessage((data) => {
  console.log(`[LOG] ${data.user}: ${data.text}`);
});

// Display messages in UI
client.on.chat.onMessage((data) => {
  addMessageToUI(data);
});

// Save to local storage
client.on.chat.onMessage((data) => {
  saveMessageLocally(data);
});
```

All listeners will be called when a message arrives.

## Listener Patterns

### Update UI

```typescript
client.on.game.onState((data) => {
  updateGameUI(data);
  renderPlayers(data.players);
  updateScore(data.score);
});
```

### Store in State

```typescript
const messages = [];

client.on.chat.onMessage((data) => {
  messages.push(data);
  updateUI();
});
```

### Conditional Logic

```typescript
client.on.notification.onReceive((data) => {
  if (data.type === "error") {
    showErrorModal(data.message);
  } else if (data.type === "warning") {
    showWarningBanner(data.message);
  } else {
    showInfoToast(data.message);
  }
});
```

### Call APIs

```typescript
client.on.user.onUpdated(async (data) => {
  await fetch("/api/sync", {
    method: "POST",
    body: JSON.stringify(data),
  });
});
```

## Best Practices

### 1. Set Up Listeners Early

```typescript
// ✅ Good: Set up before connection opens
client.on.chat.onMessage((data) => {
  console.log(data);
});

client.onOpen(() => {
  console.log("Connected!");
});

// Messages won't be missed
```

### 2. Clean Up Listeners

```typescript
// In React
useEffect(() => {
  const unsubscribe = client.on.chat.onMessage((data) => {
    setMessages((prev) => [...prev, data]);
  });

  return () => unsubscribe(); // Clean up
}, []);
```

### 3. Handle Errors

```typescript
client.on.error.onError((data) => {
  console.error("Server error:", data.message);
  showErrorNotification(data.message);
});
```

### 4. Avoid Heavy Processing

```typescript
// ❌ Bad: Heavy processing blocks UI
client.on.game.onState((data) => {
  for (let i = 0; i < 1000000; i++) {
    // Expensive calculation
  }
  updateUI(data);
});

// ✅ Good: Defer heavy work
client.on.game.onState((data) => {
  requestIdleCallback(() => {
    // Heavy processing
  });
  updateUI(data); // Fast update
});
```

## Next Steps

- [Send messages](/client/sending-messages)
- [Manage connections](/client/connection-management)
- [Use with React](/react/overview)
