---
title: Connection Management
description: Learn how to manage WebSocket connections in Zocket clients.
---

# Connection Management

Zocket clients provide built-in connection management with automatic reconnection and lifecycle hooks.

## Connection State

Check the current connection state:

```typescript
console.log(client.readyState);
// 0 = CONNECTING
// 1 = OPEN (connected)
// 2 = CLOSING
// 3 = CLOSED
```

## Lifecycle Hooks

### onOpen

Called when connection opens:

```typescript
client.onOpen(() => {
  console.log("‚úÖ Connected!");

  // Initialize app
  client.send.connection.init({});

  // Update UI
  document.querySelector("#status").textContent = "Online";
});
```

### onClose

Called when connection closes:

```typescript
client.onClose(() => {
  console.log("‚ùå Disconnected");

  // Update UI
  document.querySelector("#status").textContent = "Offline";

  // Clear state
  clearAppState();
});
```

## Automatic Reconnection

Zocket automatically reconnects with exponential backoff:

```typescript
const client = createZocketClient<AppRouter>("ws://localhost:3000", {
  maxReconnectionDelay: 10000, // Max 10 seconds between retries
  minReconnectionDelay: 1000, // Start with 1 second
  reconnectionDelayGrowFactor: 1.3, // Increase by 30% each time
  maxRetries: Infinity, // Never give up
});
```

### Reconnection Flow

```
Connection lost
   ‚Üì
Wait 1 second
   ‚Üì
Retry (failed)
   ‚Üì
Wait 1.3 seconds
   ‚Üì
Retry (failed)
   ‚Üì
Wait 1.69 seconds
   ‚Üì
... (continues up to maxReconnectionDelay)
```

## Manual Control

### Manually Reconnect

```typescript
button.addEventListener("click", () => {
  client.reconnect();
});
```

### Close Connection

```typescript
client.close();
```

## Complete Example

```typescript
import { createZocketClient } from "@zocket/core";
import type { AppRouter } from "./server";

const client = createZocketClient<AppRouter>("ws://localhost:3000", {
  headers: {
    authorization: getToken(),
  },

  // Reconnection config
  maxReconnectionDelay: 10000,
  minReconnectionDelay: 1000,
  reconnectionDelayGrowFactor: 1.3,
  maxRetries: 10, // Try 10 times then give up

  // Lifecycle hooks
  onOpen: () => {
    console.log("‚úÖ Connected");

    // Update UI
    statusEl.textContent = "Online";
    statusEl.className = "status-online";

    // Re-join rooms
    rooms.forEach((roomId) => {
      client.send.rooms.join({ roomId });
    });

    // Sync state
    client.send.sync.request({});
  },

  onClose: () => {
    console.log("‚ùå Disconnected");

    // Update UI
    statusEl.textContent = "Offline";
    statusEl.className = "status-offline";

    // Show reconnection status
    showReconnectingIndicator();
  },
});

// Manual reconnect button
document.querySelector("#reconnect").addEventListener("click", () => {
  client.reconnect();
});
```

## Connection Indicators

### Simple Status

```typescript
const statusEl = document.querySelector("#status");

client.onOpen(() => {
  statusEl.textContent = "üü¢ Online";
});

client.onClose(() => {
  statusEl.textContent = "üî¥ Offline";
});
```

### With State

```typescript
client.onOpen(() => {
  updateStatus("connected");
});

client.onClose(() => {
  if (client.readyState === 0) {
    updateStatus("connecting");
  } else {
    updateStatus("disconnected");
  }
});
```

### Reconnection Counter

```typescript
let reconnectAttempts = 0;

client.onClose(() => {
  reconnectAttempts++;
  statusEl.textContent = `Reconnecting (attempt ${reconnectAttempts})...`;
});

client.onOpen(() => {
  reconnectAttempts = 0;
  statusEl.textContent = "Connected";
});
```

## Best Practices

### 1. Show Connection State

```typescript
// ‚úÖ Good: User knows connection state
client.onOpen(() => {
  showOnlineIndicator();
});

client.onClose(() => {
  showOfflineIndicator();
});
```

### 2. Queue Actions When Offline

```typescript
const actionQueue = [];

const performAction = (action) => {
  if (client.readyState === 1) {
    client.send.action(action);
  } else {
    actionQueue.push(action);
  }
};

client.onOpen(() => {
  // Send queued actions
  actionQueue.forEach((action) => {
    client.send.action(action);
  });
  actionQueue.length = 0;
});
```

### 3. Handle Failed Reconnection

```typescript
const client = createZocketClient<AppRouter>("ws://localhost:3000", {
  maxRetries: 5,

  onClose: () => {
    // Check if we've given up
    if (reconnectAttempts >= 5) {
      showFatalError("Unable to connect. Please refresh.");
    }
  },
});
```

### 4. Clean Up on Page Unload

```typescript
window.addEventListener("beforeunload", () => {
  client.close();
});
```

## Handling Network Changes

### Detect Online/Offline

```typescript
window.addEventListener("online", () => {
  console.log("Network restored");
  client.reconnect();
});

window.addEventListener("offline", () => {
  console.log("Network lost");
  showOfflineMessage();
});
```

### Ping/Pong

Implement heartbeat to detect stale connections:

```typescript
let pingInterval;

client.onOpen(() => {
  // Send ping every 30 seconds
  pingInterval = setInterval(() => {
    client.send.connection.ping({});
  }, 30000);
});

client.onClose(() => {
  clearInterval(pingInterval);
});

// Listen for pongs
client.on.connection.pong(() => {
  console.log("Connection alive");
  lastPongTime = Date.now();
});
```

## Next Steps

- [Pass custom headers](/client/headers)
- [Use with React](/react/overview)
- [See complete examples](/examples/ping-pong)
