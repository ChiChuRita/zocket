---
title: Ping-Pong
description: A simple example demonstrating basic message sending and receiving.
---

# Ping-Pong Example

A simple example showing the fundamentals of Zocket: sending messages from client to server and receiving responses.

## Server

```typescript
import { z } from "zod";
import { zocket, createBunServer } from "@zocket/core";

const zo = zocket.create({
  headers: z.object({
    user: z.string().default("guest"),
  }),
  onConnect: (headers, clientId) => {
    console.log(`‚úÖ ${headers.user} connected (${clientId})`);
    return { user: headers.user };
  },
  onDisconnect: (ctx, clientId) => {
    console.log(`‚ùå ${ctx.user} disconnected (${clientId})`);
  },
});

const router = {
  echo: {
    ping: zo.message.incoming({
      payload: z.object({ message: z.string() }),
    }),
    pong: zo.message.outgoing({
      payload: z.object({ reply: z.string() }),
    }),
  },
};

export type AppRouter = typeof router;

const appRouter = zo.router(router, {
  echo: {
    ping: ({ payload, ctx }) => {
      const reply = `pong: ${payload.message}`;
      ctx.send.echo.pong({ reply }).to([ctx.clientId]);
    },
  },
});

const handlers = createBunServer(appRouter, zo);

Bun.serve({
  fetch: handlers.fetch,
  websocket: handlers.websocket,
  port: 3000,
});

console.log("üöÄ Server running on ws://localhost:3000");
```

## Client

```typescript
import { createZocketClient } from "@zocket/core";
import type { AppRouter } from "./server";

const client = createZocketClient<AppRouter>("ws://localhost:3000", {
  headers: { user: "Alice" },
  debug: true,
});

client.on.echo.pong((data) => {
  console.log("Received:", data.reply);
});

client.onOpen(() => {
  console.log("Connected!");
  client.send.echo.ping({ message: "Hello!" });
});

client.onClose(() => {
  console.log("Disconnected");
});
```

## Running the Example

```bash
# Terminal 1: Start server
bun server.ts

# Terminal 2: Run client
bun client.ts
```

## Output

```
# Server
‚úÖ Alice connected (client_1234...)
‚ùå Alice disconnected (client_1234...)

# Client
Connected!
Received: pong: Hello!
Disconnected
```

## Key Concepts

- **Type Safety**: Both client and server know the exact message shapes
- **Automatic Routing**: Messages are routed to the correct handlers
- **Validation**: Payloads are validated automatically
- **Lifecycle**: `onConnect` and `onDisconnect` hooks manage connection lifecycle
