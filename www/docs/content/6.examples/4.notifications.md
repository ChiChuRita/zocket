---
title: Notifications
description: Implement a flexible notification system with broadcasting and targeting.
---

# Notifications Example

Build a notification system that supports broadcasting, targeted delivery, and room-based notifications.

## Implementation

From `packages/core/test/fluent-api.test.ts`:

```typescript
const router = {
  notification: {
    send: zo.message.incoming({
      payload: z.object({
        type: z.enum(['info', 'warning', 'error']),
        message: z.string(),
        targets: z.array(z.string()).optional(),
        rooms: z.array(z.string()).optional(),
        broadcast: z.boolean().optional(),
      }),
    }),
    onReceive: zo.message.outgoing({
      payload: z.object({
        type: z.enum(['info', 'warning', 'error']),
        message: z.string(),
        timestamp: z.date(),
      }),
    }),
  },
};

const protectedMessage = zo.message.use(({ ctx }) => {
  if (ctx.userRole === 'admin' || ctx.userRole === 'moderator') {
    return { isPrivileged: true };
  }
  throw new Error('Forbidden');
});

const router = {
  notification: {
    send: protectedMessage.incoming({
      payload: z.object({...}),
    }),
  },
};

const appRouter = zo.router(router, {
  notification: {
    send: ({ payload, ctx }) => {
      const notification = {
        type: payload.type,
        message: payload.message,
        timestamp: new Date(),
      };

      if (payload.broadcast) {
        ctx.send.notification.onReceive(notification).broadcast();
      } else if (payload.targets?.length) {
        ctx.send.notification.onReceive(notification).to(payload.targets);
      } else if (payload.rooms?.length) {
        ctx.send.notification.onReceive(notification).toRoom(payload.rooms);
      }
    },
  },
});
```

## Client Usage

```typescript
// Listen for notifications
client.on.notification.onReceive((data) => {
  const icon = {
    info: "ℹ️",
    warning: "⚠️",
    error: "❌",
  }[data.type];

  console.log(`${icon} ${data.message}`);
  showToast(data.type, data.message);
});

// Admin sends broadcast notification
client.send.notification.send({
  type: "info",
  message: "System maintenance in 5 minutes",
  broadcast: true,
});

// Send to specific users
client.send.notification.send({
  type: "warning",
  message: "Your session will expire soon",
  targets: ["user1", "user2"],
});

// Send to rooms
client.send.notification.send({
  type: "info",
  message: "New feature available!",
  rooms: ["general", "announcements"],
});
```

## Features

- **Multiple Delivery Methods**: Broadcast, targeted, or room-based
- **Type System**: Different notification types (info, warning, error)
- **Authorization**: Protected with middleware (admin/moderator only)
- **Flexible**: Choose delivery method per notification
