---
title: zocket.create
description: API reference for the zocket.create function.
---

# zocket.create()

Creates a Zocket server instance with configuration for headers, connection lifecycle, and context.

## Signature

```typescript
function create<
  THeadersSchema extends StandardSchemaV1,
  TUserContext = {}
>(config: {
  headers: THeadersSchema;
  onConnect?: (
    headers: StandardSchemaV1.InferOutput<THeadersSchema>,
    clientId: string
  ) => TUserContext | Promise<TUserContext>;
  onDisconnect?: (
    ctx: DisconnectContext<TUserContext>,
    clientId: string
  ) => void | Promise<void>;
}): Zocket<THeadersSchema, TUserContext>;
```

## Parameters

### config.headers (required)

Schema for validating client headers. Must be a Zod or Valibot schema.

```typescript
headers: z.object({
  authorization: z.string(),
  "user-agent": z.string().optional(),
});
```

### config.onConnect (optional)

Callback when a client connects. Returns user context.

```typescript
onConnect: async (headers, clientId) => {
  const user = await validateToken(headers.authorization);
  return {
    userId: user.id,
    username: user.name,
  };
};
```

**Parameters:**

- `headers`: Validated headers object
- `clientId`: Unique client identifier

**Returns:** User context object (becomes part of `ctx` in handlers)

### config.onDisconnect (optional)

Callback when a client disconnects.

```typescript
onDisconnect: async (ctx, clientId) => {
  await logDisconnection(ctx.userId, clientId);
};
```

**Parameters:**

- `ctx`: User context with `rooms` as ReadonlySet
- `clientId`: Unique client identifier

## Returns

`Zocket<THeadersSchema, TUserContext>` object with:

### message

Message builder for creating message definitions:

```typescript
zo.message.incoming({ payload: z.object({...}) })
zo.message.outgoing({ payload: z.object({...}) })
zo.message.use(middleware)
```

### router

Function to create the application router:

```typescript
zo.router(routes, handlers);
```

## Example

```typescript
import { z } from "zod";
import { zocket } from "@zocket/core";

const zo = zocket.create({
  headers: z.object({
    authorization: z.string(),
  }),
  onConnect: async (headers, clientId) => {
    const user = await validateToken(headers.authorization);
    return {
      userId: user.id,
      username: user.name,
      role: user.role,
    };
  },
  onDisconnect: async (ctx, clientId) => {
    await database.updateLastSeen(ctx.userId);
  },
});
```

## Type Parameters

- `THeadersSchema`: Type of the headers schema
- `TUserContext`: Type of the user context (inferred from `onConnect` return type)
